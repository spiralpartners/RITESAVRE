<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>スプリントバーンダウンチャート</title>

<link rel="stylesheet" type="text/css" href="css/default.css" />

<script type="text/javascript" src="https://www.google.com/jsapi"></script>

<script type='text/javascript' src='dwr/engine.js'></script>
<script type='text/javascript'
	src='dwr/interface/DisplayFluentdLogAnalysisController.js'></script>

<script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
</head>


<body>
	<div id="mstone">
		<select id="mstone_menu">
			<option value="">- milestone -</option>
		</select>
	</div>
	<div id="bd_chart"></div>
	<div id="loading">
		<img src="images/loading.gif" />
	</div>


	<table>
		<tr>
			<td id="as_chart"></td>
			<td id="as_sub_chart" style="float: left;"></td>
		</tr>
	</table>
	<div id="taskest"></div>

	<script type='text/javascript'>

	// プロジェクト名を定数化
	//var project = 'trac_legoPrep';
	var project = 'trac_EventSpiral';


	// エラーメッセージの更新
	function updateErrorMsg(msg, exc) {
		$('#error_msg').text(msg);
	};

	function createMilestoneList() {
		BurnDownChartController.listMilestones(project, {
			callback: function(data) {
				var buff = $('#mstone_menu').html();
				for (var i=0; i<data.length; i++) {
					buff += '<option value="' + data[i] + '">' + data[i] + '</option>';
				}
				$('#mstone_menu').html(buff);
			},
			exceptionHandler: updateErrorMsg
		})
	};

	$('#mstone_menu').change(function() {
		milestone = $(this).val();
		drawTaskEstimationList(project, milestone);
	});
	function drawTaskEstimationList(project, milestone) {
		var form = {project:project, milestone:milestone};
		DisplayEstimationAccuracyController.execute(form, {
			callback: function(data){
			console.log(data)
			console.log(data[0].ticketId)
			var total=-1;
			var estimated=-1;
			var ticket=-1;
			for (var i=0; i<data.length; i++) {

				if(ticket == data[i].ticketId){
					$("#taskest").append("<div>" + data[i].ticketId + "\t" + data[i].totalhours + "\t" + estimated + "</div>");
				}
				total = data[i].totalhours;
				estimated = data[i].estimatedhours;
				ticket = data[i].ticketId;


			}

			}
			})
			}

	$(function() {
		drawAccessLogList();
	});

	function drawAccessLogList() {
		DisplayFluentdLogAnalysisController.execute({
			callback: function(data){
			console.log(data);
			console.log(data[0].user);
			for (var i=0; i<data.length; i++) {
				for(var j=0;j<data[i].accessDateList.length;j++){
					$("#taskest").append("<div>" + data[i].user + "\t" + toLocaleString(data[i].accessDateList[j]) + "</div>");
				}
			}

		}
		})
	}
	function toLocaleString( date )
	{
	    return [
	        date.getFullYear(),
	        date.getMonth() + 1,
	        date.getDate()
	        ].join( '/' ) + ' '
	        + date.toLocaleTimeString();
	}


	const REFRESH_INTERVAL = 10*60*1000; //10分間隔でグラフ更新
	const CHECK_INTERVAL = 1000;         //毎秒チェック
	var refreshTimer;

	</script>
</body>

</html>